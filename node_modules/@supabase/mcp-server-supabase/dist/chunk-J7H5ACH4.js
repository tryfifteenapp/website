import{g as R,h as C,i as x,j as B,k as M,l as G,n as D}from"./chunk-OSDQ3JLU.js";import{a as _,e as j,f as A}from"./chunk-AFPBIW7K.js";import{getMultipartBoundary as J,parseMultipartStream as V}from"@mjackson/multipart-parser";import{relative as P}from"path/posix";import{fileURLToPath as q}from"url";import L from"openapi-fetch";import{z as k}from"zod";function v(i,g,l={}){return L({baseUrl:i,headers:{Authorization:`Bearer ${g}`,...l}})}var $=k.object({message:k.string()});function r(i,g){if("error"in i){if(i.response.status===401)throw new Error("Unauthorized. Please provide a valid access token to the MCP server via the --access-token flag or SUPABASE_ACCESS_TOKEN.");let{data:l}=$.safeParse(i.error);throw l?new Error(l.message):new Error(g)}}var H="ABCDEFGHIJKLMNOPQRSTUVWXYZ",N="abcdefghijklmnopqrstuvwxyz",I="0123456789",K="!@#$%^&*()_+~`|}{[]:;?><,./-=",U=({length:i=10,numbers:g=!1,symbols:l=!1,uppercase:y=!0,lowercase:a=!0}={})=>{let d="";if(y&&(d+=H),a&&(d+=N),g&&(d+=I),l&&(d+=K),d.length===0)throw new Error("at least one character set must be selected");let w=new Uint32Array(i);crypto.getRandomValues(w);let O="";for(let h=0;h<i;h++){let b=w[h]%d.length;O+=d.charAt(b)}return O};var{version:W}=_;function le(i){let{accessToken:g,apiUrl:l}=i,y=l??"https://api.supabase.com",a=v(y,g),d={async listOrganizations(){let t=await a.GET("/v1/organizations");return r(t,"Failed to fetch organizations"),t.data},async getOrganization(t){let e=await a.GET("/v1/organizations/{slug}",{params:{path:{slug:t}}});return r(e,"Failed to fetch organization"),e.data},async listProjects(){let t=await a.GET("/v1/projects");return r(t,"Failed to fetch projects"),t.data},async getProject(t){let e=await a.GET("/v1/projects/{ref}",{params:{path:{ref:t}}});return r(e,"Failed to fetch project"),e.data},async createProject(t){let{name:e,organization_id:s,region:n,db_pass:o}=R.parse(t),p=await a.POST("/v1/projects",{body:{name:e,region:n,organization_id:s,db_pass:o??U({length:16,numbers:!0,uppercase:!0,lowercase:!0})}});return r(p,"Failed to create project"),p.data},async pauseProject(t){let e=await a.POST("/v1/projects/{ref}/pause",{params:{path:{ref:t}}});r(e,"Failed to pause project")},async restoreProject(t){let e=await a.POST("/v1/projects/{ref}/restore",{params:{path:{ref:t}}});r(e,"Failed to restore project")}},w={async executeSql(t,e){let{query:s,read_only:n}=M.parse(e),o=await a.POST("/v1/projects/{ref}/database/query",{params:{path:{ref:t}},body:{query:s,read_only:n}});return r(o,"Failed to execute SQL query"),o.data},async listMigrations(t){let e=await a.GET("/v1/projects/{ref}/database/migrations",{params:{path:{ref:t}}});return r(e,"Failed to fetch migrations"),e.data},async applyMigration(t,e){let{name:s,query:n}=G.parse(e),o=await a.POST("/v1/projects/{ref}/database/migrations",{params:{path:{ref:t}},body:{name:s,query:n}});r(o,"Failed to apply migration")}},O={async getLogs(t,e){let{sql:s,iso_timestamp_start:n,iso_timestamp_end:o}=D.parse(e),p=await a.GET("/v1/projects/{ref}/analytics/endpoints/logs.all",{params:{path:{ref:t},query:{sql:s,iso_timestamp_start:n,iso_timestamp_end:o}}});return r(p,"Failed to fetch logs"),p.data},async getSecurityAdvisors(t){let e=await a.GET("/v1/projects/{ref}/advisors/security",{params:{path:{ref:t}}});return r(e,"Failed to fetch security advisors"),e.data},async getPerformanceAdvisors(t){let e=await a.GET("/v1/projects/{ref}/advisors/performance",{params:{path:{ref:t}}});return r(e,"Failed to fetch performance advisors"),e.data}},h={async getProjectUrl(t){let e=new URL(y);return`https://${t}.${Q(e.hostname)}`},async getAnonKey(t){let e=await a.GET("/v1/projects/{ref}/api-keys",{params:{path:{ref:t},query:{reveal:!1}}});r(e,"Failed to fetch API keys");let s=e.data?.find(n=>n.name==="anon");if(!s?.api_key)throw new Error("Anonymous key not found");return s.api_key},async generateTypescriptTypes(t){let e=await a.GET("/v1/projects/{ref}/types/typescript",{params:{path:{ref:t}}});return r(e,"Failed to fetch TypeScript types"),e.data}},b={async listEdgeFunctions(t){let e=await a.GET("/v1/projects/{ref}/functions",{params:{path:{ref:t}}});return r(e,"Failed to fetch Edge Functions"),await Promise.all(e.data.map(async s=>await b.getEdgeFunction(t,s.slug)))},async getEdgeFunction(t,e){let s=await a.GET("/v1/projects/{ref}/functions/{function_slug}",{params:{path:{ref:t,function_slug:e}}});if(s.error)throw s.error;r(s,"Failed to fetch Edge Function");let n=s.data,o=j(t,n.id,n.version),p=A(o),E=n.entrypoint_path?P(p,q(n.entrypoint_path,{windows:!1})):void 0,F=n.import_map_path?P(p,q(n.import_map_path,{windows:!1})):void 0,m=await a.GET("/v1/projects/{ref}/functions/{function_slug}/body",{params:{path:{ref:t,function_slug:e}},headers:{Accept:"multipart/form-data"},parseAs:"stream"});r(m,"Failed to fetch Edge Function files");let c=m.response.headers.get("content-type");if(!c||!c.startsWith("multipart/form-data"))throw new Error(`Unexpected content type: ${c}. Expected multipart/form-data.`);let f=J(c);if(!f)throw new Error("No multipart boundary found in response headers");if(!m.data)throw new Error("No data received from Edge Function body");let S=[],T=V(m.data,{boundary:f});for await(let u of T)u.isFile&&u.filename&&S.push({name:P(p,u.filename),content:u.text});return{...n,entrypoint_path:E,import_map_path:F,files:S}},async deployEdgeFunction(t,e){let{name:s,entrypoint_path:n,import_map_path:o,files:p}=B.parse(e),E;try{E=await b.getEdgeFunction(t,s)}catch{}let F=p.find(c=>["deno.json","import_map.json"].includes(c.name));o??=E?.import_map_path??F?.name;let m=await a.POST("/v1/projects/{ref}/functions/deploy",{params:{path:{ref:t},query:{slug:s}},body:{metadata:{name:s,entrypoint_path:n,import_map_path:o},file:p},bodySerializer(c){let f=new FormData,S=new Blob([JSON.stringify(c.metadata)],{type:"application/json"});return f.append("metadata",S),c.file?.forEach(T=>{let u=T,z=new Blob([u.content],{type:"application/typescript"});f.append("file",z,u.name)}),f}});return r(m,"Failed to deploy Edge Function"),m.data}};return{async init(t){let{clientInfo:e}=t;if(!e)throw new Error("Client info is required");a=v(y,g,{"User-Agent":`supabase-mcp/${W} (${e.name}/${e.version})`})},account:d,database:w,debugging:O,development:h,functions:b,branching:{async listBranches(t){let e=await a.GET("/v1/projects/{ref}/branches",{params:{path:{ref:t}}});return e.response.status===422?[]:(r(e,"Failed to list branches"),e.data)},async createBranch(t,e){let{name:s}=C.parse(e),n=await a.POST("/v1/projects/{ref}/branches",{params:{path:{ref:t}},body:{branch_name:s}});return r(n,"Failed to create branch"),n.data},async deleteBranch(t){let e=await a.DELETE("/v1/branches/{branch_id}",{params:{path:{branch_id:t}}});r(e,"Failed to delete branch")},async mergeBranch(t){let e=await a.POST("/v1/branches/{branch_id}/merge",{params:{path:{branch_id:t}},body:{}});r(e,"Failed to merge branch")},async resetBranch(t,e){let{migration_version:s}=x.parse(e),n=await a.POST("/v1/branches/{branch_id}/reset",{params:{path:{branch_id:t}},body:{migration_version:s}});r(n,"Failed to reset branch")},async rebaseBranch(t){let e=await a.POST("/v1/branches/{branch_id}/push",{params:{path:{branch_id:t}},body:{}});r(e,"Failed to rebase branch")}},storage:{async listAllBuckets(t){let e=await a.GET("/v1/projects/{ref}/storage/buckets",{params:{path:{ref:t}}});return r(e,"Failed to list storage buckets"),e.data},async getStorageConfig(t){let e=await a.GET("/v1/projects/{ref}/config/storage",{params:{path:{ref:t}}});return r(e,"Failed to get storage config"),e.data},async updateStorageConfig(t,e){let s=await a.PATCH("/v1/projects/{ref}/config/storage",{params:{path:{ref:t}},body:{fileSizeLimit:e.fileSizeLimit,features:{imageTransformation:{enabled:e.features.imageTransformation.enabled},s3Protocol:{enabled:e.features.s3Protocol.enabled}}}});return r(s,"Failed to update storage config"),s.data}}}}function Q(i){switch(i){case"api.supabase.com":return"supabase.co";case"api.supabase.green":return"supabase.green";default:return"supabase.red"}}export{le as a};
//# sourceMappingURL=chunk-J7H5ACH4.js.map